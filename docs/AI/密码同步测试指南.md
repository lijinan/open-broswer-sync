# 密码同步测试指南

## 🎯 测试目标

验证密码同步功能的完整工作流程，包括：
- 密码检测和保存
- 跨浏览器实时同步
- 自动填充功能
- CORS跨域访问

## 🚀 快速测试步骤

### 1. 确保服务运行

```bash
# 后端服务 (端口3001)
cd backend
npm start

# 前端服务 (端口3002) 
cd web-client
npm run dev

# 测试服务器 (端口8080)
python start-test-server.py
```

### 2. 安装和配置扩展

#### Chrome
1. 打开 `chrome://extensions/`
2. 启用"开发者模式"
3. 加载 `browser-extension` 文件夹
4. 点击扩展图标，登录账号

#### Firefox  
1. 打开 `about:debugging`
2. 加载 `browser-extension/manifest-firefox.json`
3. 点击扩展图标，登录账号

### 3. 测试CORS修复

访问：`http://localhost:8080/browser-extension/test/test-cors.html`

**测试步骤：**
1. 点击"测试健康检查API" - 应该成功
2. 点击"测试登录API" - 应该获得token
3. 点击"测试密码API" - 应该成功创建密码

**预期结果：**
- ✅ 所有API调用成功
- ✅ 没有CORS错误
- ✅ 控制台显示成功消息

### 4. 测试密码检测和保存

访问：`http://localhost:8080/browser-extension/test/password-demo.html`

**测试步骤：**
1. 点击"演示账号1"填充表单
2. 点击"登录"提交表单
3. 确认扩展弹出保存对话框
4. 点击"确定"保存密码

**预期结果：**
- ✅ 扩展检测到密码表单
- ✅ 弹出保存确认对话框
- ✅ 密码成功保存到服务器
- ✅ 显示保存成功通知

### 5. 测试跨浏览器同步

**测试步骤：**
1. 在Chrome中保存密码（步骤4）
2. 打开Firefox并安装扩展
3. 登录相同账号
4. 访问相同的演示页面
5. 检查密码是否已同步

**预期结果：**
- ✅ Firefox中能看到Chrome保存的密码
- ✅ WebSocket实时通知工作正常
- ✅ 密码数据完整同步

### 6. 测试自动填充

**测试步骤：**
1. 清空演示页面的表单
2. 点击扩展图标
3. 点击"检测密码"按钮
4. 或点击页面上的🔑按钮

**预期结果：**
- ✅ 用户名和密码自动填充
- ✅ 填充的数据正确
- ✅ 表单可以正常提交

## 🔧 故障排除

### 常见问题

#### 1. CORS错误
**症状：** 控制台显示跨域访问被阻止
**解决：** 
- 确认后端已重启
- 检查 `backend/.env` 中的 `ALLOWED_ORIGINS`
- 访问CORS测试页面验证

#### 2. 扩展无法检测密码
**症状：** 提交表单后没有保存对话框
**解决：**
- 检查扩展是否已登录
- 确认content script已加载
- 查看浏览器控制台错误信息

#### 3. 跨浏览器同步失败
**症状：** 在另一个浏览器中看不到密码
**解决：**
- 确认两个浏览器都已登录相同账号
- 检查WebSocket连接状态
- 查看后端日志确认通知发送

#### 4. 自动填充不工作
**症状：** 点击填充按钮没有反应
**解决：**
- 确认已保存该网站的密码
- 检查表单结构是否标准
- 尝试刷新页面重试

### 调试工具

#### 浏览器控制台
```javascript
// 检查扩展API
console.log('Extension API:', typeof chrome !== 'undefined' ? 'Chrome' : 'Firefox');

// 检查content script
console.log('Content script loaded:', typeof PasswordManager !== 'undefined');
```

#### 网络面板
- 查看API请求状态
- 检查WebSocket连接
- 确认CORS头部信息

#### 扩展调试
- Chrome: `chrome://extensions/` → 详细信息 → 检查视图
- Firefox: `about:debugging` → 此Firefox → 检查

## 📊 测试检查清单

### 基础功能
- [ ] 后端服务正常启动
- [ ] 前端服务正常启动  
- [ ] 测试服务器正常启动
- [ ] 扩展成功安装和登录

### CORS配置
- [ ] 健康检查API可访问
- [ ] 登录API可访问
- [ ] 密码API可访问
- [ ] 没有跨域错误

### 密码检测
- [ ] 表单提交时检测到密码
- [ ] 弹出保存确认对话框
- [ ] 密码成功保存到服务器
- [ ] 显示保存成功通知

### 跨浏览器同步
- [ ] Chrome保存的密码在Firefox中可见
- [ ] Firefox保存的密码在Chrome中可见
- [ ] WebSocket实时通知正常
- [ ] 密码数据完整同步

### 自动填充
- [ ] 扩展弹窗填充功能正常
- [ ] 页面🔑按钮填充功能正常
- [ ] 多密码选择功能正常
- [ ] 填充的数据准确无误

### 错误处理
- [ ] 网络错误有友好提示
- [ ] 重复密码有去重处理
- [ ] 无效表单有错误提示
- [ ] 未登录状态有提示信息

## 🎉 测试完成

当所有检查项都通过时，密码同步功能测试完成！

**功能特性：**
- ✅ 智能密码检测
- ✅ 安全加密存储
- ✅ 跨浏览器同步
- ✅ 便捷自动填充
- ✅ 实时通知推送
- ✅ 友好用户界面

**技术实现：**
- ✅ Content Script密码检测
- ✅ WebSocket实时通信
- ✅ AES加密安全存储
- ✅ CORS跨域访问支持
- ✅ Chrome/Firefox兼容性

密码同步功能现已完全可用，为用户提供安全、便捷的密码管理体验！