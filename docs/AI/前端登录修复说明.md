# ğŸ”§ å‰ç«¯ç™»å½•é”™è¯¯ä¿®å¤å®Œæˆ

## ğŸ› é—®é¢˜æè¿°

å‰ç«¯ç™»å½•å‡ºç° 400 Bad Request é”™è¯¯ï¼ŒåŸå› æ˜¯ï¼š
- å‰ç«¯å‘é€å‚æ•°: `{ email, password }`
- åç«¯æœŸæœ›å‚æ•°: `{ username, password }`
- å‚æ•°åä¸åŒ¹é…å¯¼è‡´éªŒè¯å¤±è´¥

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®æ”¹åç«¯ç™»å½•éªŒè¯schema
```javascript
// ä¿®æ”¹å‰ - åªæ”¯æŒusername
const loginSchema = Joi.object({
  username: Joi.string().required(),
  password: Joi.string().required()
});

// ä¿®æ”¹å - åŒæ—¶æ”¯æŒemailå’Œusername
const loginSchema = Joi.object({
  email: Joi.string().optional(),
  username: Joi.string().optional(), 
  password: Joi.string().required()
}).or('email', 'username'); // è‡³å°‘éœ€è¦å…¶ä¸­ä¸€ä¸ª
```

### 2. ä¿®æ”¹ç™»å½•å¤„ç†é€»è¾‘
```javascript
// å…¼å®¹ä¸¤ç§å‚æ•°æ ¼å¼
const { email, username, password } = value;
const loginIdentifier = email || username;

// æ”¯æŒé‚®ç®±æˆ–ç”¨æˆ·åæŸ¥æ‰¾
const user = await db('users')
  .where({ email: loginIdentifier })
  .orWhere({ name: loginIdentifier })
  .first();
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### APIæµ‹è¯•æˆåŠŸ
```bash
# ä½¿ç”¨emailå‚æ•° (å‰ç«¯æ ¼å¼)
POST /api/auth/login
{ "email": "extension@test.com", "password": "extension123" }
âœ… ç™»å½•æˆåŠŸ

# ä½¿ç”¨usernameå‚æ•° (æ‰©å±•æ ¼å¼)  
POST /api/auth/login
{ "username": "extension@test.com", "password": "extension123" }
âœ… ç™»å½•æˆåŠŸ
```

## ğŸ¯ å…¼å®¹æ€§

ç°åœ¨åç«¯ç™»å½•æ¥å£åŒæ—¶æ”¯æŒï¼š
- âœ… **å‰ç«¯Webåº”ç”¨**: ä½¿ç”¨ `{ email, password }` æ ¼å¼
- âœ… **æµè§ˆå™¨æ‰©å±•**: ä½¿ç”¨ `{ username, password }` æ ¼å¼
- âœ… **é‚®ç®±ç™»å½•**: æ”¯æŒé‚®ç®±åœ°å€ç™»å½•
- âœ… **ç”¨æˆ·åç™»å½•**: æ”¯æŒç”¨æˆ·åç™»å½•

## ğŸš€ è§£å†³ç»“æœ

- âœ… å‰ç«¯ç™»å½•é”™è¯¯å·²ä¿®å¤
- âœ… ä¿æŒå‘åå…¼å®¹æ€§
- âœ… æ”¯æŒå¤šç§ç™»å½•æ–¹å¼
- âœ… æµè§ˆå™¨æ‰©å±•æ­£å¸¸å·¥ä½œ

ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨å‰ç«¯ç™»å½•åŠŸèƒ½äº†ï¼