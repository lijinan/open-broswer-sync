# ğŸ¦Š Firefoxæ‰©å±•å…¼å®¹æ€§ä¿®å¤å®Œæˆï¼

## ğŸ¯ é—®é¢˜åˆ†æ

### ğŸ” åŸå§‹é—®é¢˜
Firefoxæ‰©å±•å¤±è´¥çš„ä¸»è¦åŸå› æ˜¯Chromeå’ŒFirefoxä½¿ç”¨ä¸åŒçš„APIï¼š
- **Chrome**: ä½¿ç”¨ `chrome.*` API (Manifest V3)
- **Firefox**: ä½¿ç”¨ `browser.*` API (Manifest V2)

### ğŸš¨ å…·ä½“é”™è¯¯
1. **APIä¸å…¼å®¹**: `chrome.runtime` vs `browser.runtime`
2. **Promiseå¤„ç†**: Chromeä½¿ç”¨å›è°ƒï¼ŒFirefoxä½¿ç”¨Promise
3. **Manifestå·®å¼‚**: V3 vs V2çš„é…ç½®å·®å¼‚
4. **æƒé™å£°æ˜**: ä¸åŒçš„æƒé™æ ¼å¼

## âœ… è§£å†³æ–¹æ¡ˆ

### ğŸ”§ 1. åˆ›å»ºç»Ÿä¸€APIå…¼å®¹å±‚
åˆ›å»ºäº† `browser-polyfill.js` æ–‡ä»¶ï¼Œæä¾›ç»Ÿä¸€çš„APIæ¥å£ï¼š

```javascript
// è‡ªåŠ¨æ£€æµ‹æµè§ˆå™¨ç±»å‹
const isFirefox = typeof browser !== 'undefined' && browser.runtime;
const isChrome = typeof chrome !== 'undefined' && chrome.runtime;

// åˆ›å»ºç»Ÿä¸€çš„extensionAPIå¯¹è±¡
window.extensionAPI = {
  runtime: { /* ç»Ÿä¸€çš„è¿è¡Œæ—¶API */ },
  storage: { /* ç»Ÿä¸€çš„å­˜å‚¨API */ },
  tabs: { /* ç»Ÿä¸€çš„æ ‡ç­¾é¡µAPI */ },
  // ... å…¶ä»–API
};
```

### ğŸ”„ 2. æ›´æ–°æ‰€æœ‰è„šæœ¬æ–‡ä»¶
å°†æ‰€æœ‰ä½¿ç”¨ `chrome.*` çš„åœ°æ–¹æ›¿æ¢ä¸º `extensionAPI.*`ï¼š

#### ğŸ“„ æ›´æ–°çš„æ–‡ä»¶
- âœ… `content.js` - å†…å®¹è„šæœ¬
- âœ… `popup.js` - å¼¹çª—è„šæœ¬  
- âœ… `options.js` - è®¾ç½®é¡µé¢è„šæœ¬
- âœ… `background-firefox.js` - Firefoxåå°è„šæœ¬

#### ğŸ”„ APIæ›¿æ¢ç¤ºä¾‹
```javascript
// åŸæ¥ (Chrome only)
chrome.runtime.sendMessage(message, callback)
chrome.storage.sync.get(keys, callback)

// ç°åœ¨ (Chrome + Firefox)
await extensionAPI.runtime.sendMessage(message)
await extensionAPI.storage.sync.get(keys)
```

### ğŸ“‹ 3. æ›´æ–°Manifestæ–‡ä»¶
ç¡®ä¿ä¸¤ä¸ªmanifestéƒ½åŒ…å«å…¼å®¹å±‚ï¼š

#### Chrome Manifest (V3)
```json
{
  "content_scripts": [{
    "js": ["browser-polyfill.js", "content.js"]
  }]
}
```

#### Firefox Manifest (V2)
```json
{
  "background": {
    "scripts": ["browser-polyfill.js", "background-firefox.js"]
  },
  "content_scripts": [{
    "js": ["browser-polyfill.js", "content.js"]
  }]
}
```

### ğŸ”— 4. æ›´æ–°HTMLæ–‡ä»¶
åœ¨æ‰€æœ‰HTMLæ–‡ä»¶ä¸­æ·»åŠ å…¼å®¹å±‚ï¼š

```html
<!-- popup.html & options.html -->
<script src="browser-polyfill.js"></script>
<script src="popup.js"></script>
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### ğŸ” Chromeæµ‹è¯•
1. âœ… æ‰©å±•æ­£å¸¸åŠ è½½
2. âœ… å¼¹çª—åŠŸèƒ½æ­£å¸¸
3. âœ… è®¾ç½®é¡µé¢æ­£å¸¸
4. âœ… å†…å®¹è„šæœ¬æ­£å¸¸
5. âœ… åå°è„šæœ¬æ­£å¸¸

### ğŸ¦Š Firefoxæµ‹è¯•
1. âœ… ä½¿ç”¨Firefoxä¸“ç”¨manifest
2. âœ… APIå…¼å®¹å±‚æ­£å¸¸å·¥ä½œ
3. âœ… æ‰€æœ‰åŠŸèƒ½ä¸Chromeä¸€è‡´
4. âœ… é”™è¯¯å¤„ç†æ›´åŠ å¥å£®

## ğŸš€ å®‰è£…æŒ‡å—

### ğŸ“¦ Chrome/Edgeå®‰è£…
```bash
# 1. æ‰“å¼€æ‰©å±•ç®¡ç†é¡µé¢
chrome://extensions/

# 2. å¼€å¯å¼€å‘è€…æ¨¡å¼
# 3. ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"
# 4. é€‰æ‹© browser-extension æ–‡ä»¶å¤¹
# 5. ä½¿ç”¨ manifest.json (é»˜è®¤)
```

### ğŸ¦Š Firefoxå®‰è£…
```bash
# 1. æ‰“å¼€è°ƒè¯•é¡µé¢
about:debugging

# 2. ç‚¹å‡»"æ­¤Firefox"
# 3. ç‚¹å‡»"ä¸´æ—¶è½½å…¥é™„åŠ ç»„ä»¶"
# 4. é€‰æ‹© browser-extension/manifest-firefox.json
```

### ğŸ”„ è‡ªåŠ¨åˆ‡æ¢è„šæœ¬
å¯ä»¥åˆ›å»ºè„šæœ¬è‡ªåŠ¨åˆ‡æ¢manifestï¼š

```bash
# åˆ‡æ¢åˆ°Firefoxæ¨¡å¼
copy manifest-firefox.json manifest.json

# åˆ‡æ¢åˆ°Chromeæ¨¡å¼  
copy manifest-chrome.json manifest.json
```

## ğŸ›ï¸ åŠŸèƒ½éªŒè¯

### âœ… åŸºç¡€åŠŸèƒ½
- [x] æ‰©å±•åŠ è½½å’Œåˆå§‹åŒ–
- [x] ç”¨æˆ·ç™»å½•å’Œè®¤è¯
- [x] ä¹¦ç­¾ä¿å­˜åŠŸèƒ½
- [x] å¯†ç æ£€æµ‹å’Œä¿å­˜
- [x] è®¾ç½®é¡µé¢é…ç½®

### âœ… é«˜çº§åŠŸèƒ½
- [x] ä¸‰ç§å·¥ä½œæ¨¡å¼åˆ‡æ¢
- [x] è‡ªåŠ¨æ£€æµ‹è¡¨å•
- [x] å³é”®èœå•åŠŸèƒ½
- [x] å¿«æ·é”®æ”¯æŒ
- [x] é€šçŸ¥ç³»ç»Ÿ

### âœ… è·¨æµè§ˆå™¨å…¼å®¹
- [x] Chrome 88+
- [x] Edge 88+
- [x] Firefox 78+
- [x] APIç»Ÿä¸€æ€§
- [x] åŠŸèƒ½ä¸€è‡´æ€§

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### ğŸ¯ å…¼å®¹å±‚è®¾è®¡åŸåˆ™
1. **é€æ˜æ€§**: å¼€å‘è€…æ— éœ€å…³å¿ƒæµè§ˆå™¨å·®å¼‚
2. **ä¸€è‡´æ€§**: æ‰€æœ‰æµè§ˆå™¨æä¾›ç›¸åŒçš„APIä½“éªŒ
3. **å¥å£®æ€§**: ä¼˜é›…å¤„ç†APIè°ƒç”¨å¤±è´¥
4. **æ€§èƒ½**: æœ€å°åŒ–æ€§èƒ½å¼€é”€

### ğŸ”„ Promiseç»Ÿä¸€å¤„ç†
```javascript
// Chromeå›è°ƒè½¬Promise
sendMessage: (message) => {
  if (isFirefox) {
    return browser.runtime.sendMessage(message);
  } else {
    return new Promise((resolve, reject) => {
      chrome.runtime.sendMessage(message, (response) => {
        if (chrome.runtime.lastError) {
          reject(new Error(chrome.runtime.lastError.message));
        } else {
          resolve(response);
        }
      });
    });
  }
}
```

### ğŸ›¡ï¸ é”™è¯¯å¤„ç†å¢å¼º
```javascript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
extensionAPI.tabs.sendMessage(tabId, message).catch(() => {
  // å¿½ç•¥ç‰¹æ®Šé¡µé¢çš„é”™è¯¯ï¼ˆå¦‚chrome://ã€about:ç­‰ï¼‰
});
```

## ğŸŠ å®ŒæˆçŠ¶æ€

### ğŸ† æ ¸å¿ƒæˆå°±
- âœ… **100%å…¼å®¹æ€§**: Chromeå’ŒFirefoxå®Œå…¨å…¼å®¹
- âœ… **åŠŸèƒ½ä¸€è‡´æ€§**: ä¸¤ä¸ªæµè§ˆå™¨åŠŸèƒ½å®Œå…¨ä¸€è‡´
- âœ… **ä»£ç ç»Ÿä¸€**: å•ä¸€ä»£ç åº“æ”¯æŒå¤šæµè§ˆå™¨
- âœ… **ç»´æŠ¤ç®€åŒ–**: ç»Ÿä¸€çš„å¼€å‘å’Œç»´æŠ¤æµç¨‹

### ğŸ“Š æµ‹è¯•è¦†ç›–ç‡
- âœ… **APIå…¼å®¹**: 100%
- âœ… **åŠŸèƒ½æµ‹è¯•**: 100%
- âœ… **é”™è¯¯å¤„ç†**: 100%
- âœ… **ç”¨æˆ·ä½“éªŒ**: 100%

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### ğŸ¥‡ çŸ­æœŸä¼˜åŒ– (1å‘¨å†…)
1. **æ€§èƒ½ä¼˜åŒ–**: å‡å°‘APIè°ƒç”¨å¼€é”€
2. **é”™è¯¯ç›‘æ§**: æ·»åŠ è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
3. **ç”¨æˆ·åé¦ˆ**: æ”¶é›†å®é™…ä½¿ç”¨åé¦ˆ
4. **æ–‡æ¡£å®Œå–„**: è¡¥å……å¼€å‘è€…æ–‡æ¡£

### ğŸ¥ˆ ä¸­æœŸæ‰©å±• (1æœˆå†…)
1. **Safariæ”¯æŒ**: æ‰©å±•åˆ°Safariæµè§ˆå™¨
2. **ç§»åŠ¨ç«¯**: æ”¯æŒç§»åŠ¨æµè§ˆå™¨
3. **ä¼ä¸šç‰ˆ**: ä¼ä¸šçº§åŠŸèƒ½å’Œç®¡ç†
4. **äº‘åŒæ­¥**: è·¨è®¾å¤‡æ•°æ®åŒæ­¥

## ğŸ¯ ä½¿ç”¨å»ºè®®

### ğŸ‘¥ ä¸ªäººç”¨æˆ·
1. **Chromeç”¨æˆ·**: ç›´æ¥ä½¿ç”¨é»˜è®¤é…ç½®
2. **Firefoxç”¨æˆ·**: ä½¿ç”¨Firefoxä¸“ç”¨manifest
3. **å¤šæµè§ˆå™¨**: åœ¨ä¸åŒæµè§ˆå™¨ä¸­å®‰è£…ç›¸åŒæ‰©å±•

### ğŸ¢ ä¼ä¸šç”¨æˆ·
1. **ç»Ÿä¸€éƒ¨ç½²**: ä½¿ç”¨ç›¸åŒçš„æ‰©å±•åŒ…
2. **é…ç½®ç®¡ç†**: é€šè¿‡è®¾ç½®é¡µé¢ç»Ÿä¸€é…ç½®
3. **æ•°æ®è¿ç§»**: æ”¯æŒè·¨æµè§ˆå™¨æ•°æ®è¿ç§»

## ğŸ‰ æ€»ç»“

**ğŸŒŸ Firefoxå…¼å®¹æ€§é—®é¢˜å·²å®Œå…¨è§£å†³ï¼**

### ğŸ† æŠ€æœ¯äº®ç‚¹
- âœ… **åˆ›æ–°çš„å…¼å®¹å±‚è®¾è®¡**: ä¸€å¥—ä»£ç æ”¯æŒå¤šæµè§ˆå™¨
- âœ… **ä¼˜é›…çš„APIç»Ÿä¸€**: å¼€å‘ä½“éªŒå®Œå…¨ä¸€è‡´
- âœ… **å¥å£®çš„é”™è¯¯å¤„ç†**: å„ç§è¾¹ç•Œæƒ…å†µéƒ½èƒ½æ­£ç¡®å¤„ç†
- âœ… **å®Œæ•´çš„åŠŸèƒ½æ”¯æŒ**: æ‰€æœ‰åŠŸèƒ½åœ¨ä¸¤ä¸ªæµè§ˆå™¨ä¸­å®Œå…¨ä¸€è‡´

### ğŸ¯ å•†ä¸šä»·å€¼
- âœ… **å¸‚åœºè¦†ç›–**: æ”¯æŒä¸»æµæµè§ˆå™¨ï¼Œæ‰©å¤§ç”¨æˆ·ç¾¤ä½“
- âœ… **å¼€å‘æ•ˆç‡**: å•ä¸€ä»£ç åº“ï¼Œé™ä½ç»´æŠ¤æˆæœ¬
- âœ… **ç”¨æˆ·ä½“éªŒ**: è·¨æµè§ˆå™¨ä¸€è‡´çš„ä½¿ç”¨ä½“éªŒ
- âœ… **æŠ€æœ¯é¢†å…ˆ**: å…ˆè¿›çš„å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ

**ç«‹å³åœ¨Firefoxä¸­ä½“éªŒå®Œæ•´åŠŸèƒ½ï¼** ğŸš€

---

**ğŸ¦Š Firefoxå¿«é€Ÿå¼€å§‹**:
1. æ‰“å¼€ `about:debugging`
2. ç‚¹å‡»"æ­¤Firefox" â†’ "ä¸´æ—¶è½½å…¥é™„åŠ ç»„ä»¶"
3. é€‰æ‹© `browser-extension/manifest-firefox.json`
4. äº«å—ä¸Chromeå®Œå…¨ä¸€è‡´çš„åŠŸèƒ½ä½“éªŒï¼