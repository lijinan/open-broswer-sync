# 密码检测功能使用指南

## 问题解决

### "扩展API不可用" 错误

这个错误通常发生在以下情况：

1. **在普通网页环境中测试**
   - 通过HTTP服务器访问测试页面时，扩展API不可用
   - 解决方案：使用扩展内测试页面

2. **扩展未正确加载**
   - 扩展可能需要重新加载
   - 解决方案：在扩展管理页面重新加载扩展

## 正确的测试方法

### 方法1：扩展内测试页面（推荐）

1. **访问扩展内测试页面**
   ```
   chrome-extension://[扩展ID]/test-extension.html
   ```
   
2. **获取扩展ID**
   - 打开Chrome扩展管理页面 `chrome://extensions/`
   - 找到"书签密码同步助手"扩展
   - 复制扩展ID

3. **完整测试流程**
   - 填写测试表单
   - 提交表单
   - 查看控制台日志
   - 验证密码是否保存成功

### 方法2：真实网站测试

1. **访问任意网站**（如登录页面）
2. **填写登录表单**
3. **提交表单**
4. **查看扩展是否检测到密码**

## 调试步骤

### 1. 检查扩展状态

```javascript
// 在控制台执行
chrome.runtime.sendMessage({type: 'GET_SETTINGS'}, console.log)
```

### 2. 检查登录状态

```javascript
// 在控制台执行
chrome.runtime.sendMessage({type: 'CHECK_LOGIN_STATUS'}, console.log)
```

### 3. 手动测试密码保存

```javascript
// 在控制台执行
chrome.runtime.sendMessage({
  type: 'SAVE_PASSWORD_TO_SERVER',
  data: {
    site_name: '测试网站',
    site_url: 'https://example.com',
    username: 'test@example.com',
    password: 'testpass123',
    category: '测试',
    notes: '手动测试'
  }
}, console.log)
```

## 常见问题

### Q: 为什么密码没有被检测到？

**A: 可能的原因：**
1. 扩展未登录
2. 自动检测功能被禁用
3. 表单结构不符合检测规则
4. 扩展API不可用

**解决方案：**
1. 确保扩展已登录
2. 检查扩展设置中的自动检测选项
3. 使用标准的HTML表单结构
4. 使用扩展内测试页面

### Q: 密码保存失败怎么办？

**A: 检查以下项目：**
1. 网络连接是否正常
2. 后端服务是否运行
3. 扩展是否已登录
4. 查看控制台错误信息

### Q: 如何查看详细的调试信息？

**A: 调试方法：**
1. 打开浏览器开发者工具
2. 查看Console标签页
3. 使用扩展内测试页面的调试功能
4. 导出调试日志进行分析

## 测试环境对比

| 环境 | 扩展API | CORS限制 | 推荐程度 |
|------|---------|----------|----------|
| 扩展内页面 | ✅ 完全可用 | ❌ 无限制 | ⭐⭐⭐⭐⭐ |
| HTTP测试服务器 | ❌ 不可用 | ✅ 有限制 | ⭐⭐ |
| 真实网站 | ✅ 完全可用 | ❌ 无限制 | ⭐⭐⭐⭐ |

## 最佳实践

1. **优先使用扩展内测试页面**进行功能验证
2. **在真实网站上**进行最终测试
3. **定期检查扩展登录状态**
4. **保持后端服务运行**
5. **查看控制台日志**了解详细信息

## 故障排除

### 扩展重新加载

1. 打开 `chrome://extensions/`
2. 找到扩展并点击"重新加载"
3. 重新测试功能

### 清除扩展数据

1. 打开扩展选项页面
2. 清除登录信息
3. 重新登录
4. 重新测试

### 检查后端服务

1. 确保后端服务在 `http://localhost:3001` 运行
2. 检查WebSocket连接状态
3. 验证API接口可访问性

## 技术说明

### 密码检测原理

1. **表单监听**：监听页面上的表单提交事件
2. **字段识别**：识别用户名和密码字段
3. **数据提取**：提取表单数据
4. **重复检查**：检查是否已存在相同密码
5. **用户确认**：显示保存确认对话框
6. **服务器保存**：通过API保存到服务器

### API通信架构

```
Content Script → Background Script → Backend API
```

这种架构避免了CORS跨域问题，确保在任何网站上都能正常工作。