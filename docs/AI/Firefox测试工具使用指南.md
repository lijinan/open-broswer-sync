# Firefox测试工具使用指南

## 问题解决
**问题**: Firefox打开测试页面显示错误 - "请在Firefox扩展中打开此页面"
**原因**: 测试页面需要在Firefox扩展的上下文中运行才能访问浏览器API

## 解决方案

### 方法1: 通过扩展选项页面访问（推荐）

1. **打开Firefox扩展选项页面**:
   - 方法A: 右键点击扩展图标 → 选择"选项"
   - 方法B: 在地址栏输入: `about:addons` → 找到扩展 → 点击"选项"
   - 方法C: Firefox菜单 → 附加组件和主题 → 扩展 → 找到扩展 → 选项

2. **使用内置测试工具**:
   - 在选项页面中找到"🧪 测试工具"部分
   - 点击"🦊 打开Firefox专用测试工具"按钮
   - 这将在新标签页中打开专门为Firefox设计的测试工具

### 方法2: 直接访问扩展页面

1. **获取扩展URL**:
   - 在Firefox地址栏输入: `moz-extension://[扩展ID]/firefox-test.html`
   - 扩展ID可以在`about:debugging`页面中找到

2. **通过开发者工具**:
   - 按F12打开开发者工具
   - 在控制台中输入: `browser.runtime.getURL('firefox-test.html')`
   - 复制返回的URL并在新标签页中打开

## Firefox专用测试工具功能

### 🔧 基础测试
- **检查扩展环境**: 验证Firefox扩展API可用性
- **测试用户信息**: 检查登录状态和用户信息
- **测试WebSocket连接**: 验证与后端服务器的连接

### 📚 书签测试
- **创建测试书签**: 在同步收藏夹中创建测试书签
- **移动测试书签**: 移动书签到不同文件夹
- **更新书签标题**: 修改书签标题
- **删除测试书签**: 删除测试书签

### 🔄 同步测试
- **测试书签同步**: 完整的书签同步流程测试
- **测试跨浏览器同步**: 验证Firefox与Chrome之间的同步
- **执行全量同步**: 手动触发全量同步

## 使用步骤

### 1. 准备工作
1. **确保后端服务运行**: http://localhost:3001
2. **Firefox扩展已安装**: 加载`browser-extension`目录
3. **用户已登录**: 在扩展中登录测试账号

### 2. 打开测试工具
1. 右键点击Firefox扩展图标
2. 选择"选项"
3. 滚动到"🧪 测试工具"部分
4. 点击"🦊 打开Firefox专用测试工具"

### 3. 执行测试
1. **基础检查**: 点击"检查扩展环境"确认环境正常
2. **用户验证**: 点击"测试用户信息"确认登录状态
3. **连接测试**: 点击"测试WebSocket连接"验证服务器连接
4. **功能测试**: 按需执行书签和同步相关测试

## 常见问题解决

### 问题1: "请在Firefox扩展中打开此页面"
**解决**: 不要直接在文件系统中打开HTML文件，必须通过扩展选项页面访问

### 问题2: "未检测到浏览器扩展API"
**解决**: 
- 确保在Firefox中运行
- 确保扩展已正确安装和启用
- 检查扩展权限是否正确配置

### 问题3: "用户未登录"
**解决**:
- 点击扩展图标打开弹窗
- 输入服务器地址: http://localhost:3001
- 使用测试账号登录

### 问题4: "WebSocket连接失败"
**解决**:
- 确认后端服务器运行在端口3001
- 检查防火墙设置
- 验证JWT token是否有效

### 问题5: 书签操作失败
**解决**:
- 确保扩展有书签权限
- 检查"同步收藏夹"是否存在
- 查看浏览器控制台错误信息

## 测试流程建议

### 基础功能验证
1. **检查扩展环境** → 确认API可用
2. **测试用户信息** → 验证登录状态
3. **测试WebSocket连接** → 确认服务器连接

### 书签功能验证
1. **创建测试书签** → 验证书签创建和同步
2. **移动测试书签** → 验证书签移动和同步
3. **更新书签标题** → 验证书签更新和同步
4. **删除测试书签** → 验证书签删除和同步

### 跨浏览器验证
1. **在Firefox中操作书签** → 检查Chrome是否收到通知
2. **在Chrome中操作书签** → 检查Firefox是否收到通知
3. **执行全量同步** → 验证批量同步功能

## 调试技巧

### 1. 查看扩展日志
- 打开`about:debugging`
- 找到扩展并点击"检查"
- 在控制台中查看日志

### 2. 查看后端日志
- 检查后端服务器控制台输出
- 查看WebSocket连接和书签同步日志

### 3. 网络调试
- 使用Firefox开发者工具的网络面板
- 检查API请求和WebSocket连接

## 相关文件
- `browser-extension/firefox-test.html` - Firefox专用测试页面
- `browser-extension/options.html` - 扩展选项页面
- `browser-extension/options.js` - 选项页面脚本
- `browser-extension/manifest-firefox.json` - Firefox扩展配置

## 注意事项
- 测试工具必须在Firefox扩展上下文中运行
- 某些功能需要特定的扩展权限
- 建议在测试前清空浏览器缓存
- 测试完成后记得清理测试数据