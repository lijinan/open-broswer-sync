<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自动同步功能测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
        .error { background: #f8d7da; color: #721c24; }
        .code-block {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            border-left: 4px solid #007bff;
        }
        .step-list {
            counter-reset: step-counter;
        }
        .step-list li {
            counter-increment: step-counter;
            margin: 10px 0;
            padding-left: 30px;
            position: relative;
        }
        .step-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background: #007bff;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .feature-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .feature-card h4 {
            margin-top: 0;
            color: #007bff;
        }
    </style>
</head>
<body>
    <h1>🔄 自动同步功能测试指南</h1>
    
    <div class="test-section success">
        <h2>✅ 功能概述</h2>
        <p>现在扩展支持<strong>自动同步</strong>功能！当你在浏览器中手动收藏书签到"同步收藏夹"文件夹时，扩展会自动检测并同步到服务器。</p>
        
        <div class="feature-grid">
            <div class="feature-card">
                <h4>📥 自动上传</h4>
                <p>收藏到"同步收藏夹"时自动上传到服务器</p>
            </div>
            <div class="feature-card">
                <h4>🗑️ 自动删除</h4>
                <p>删除"同步收藏夹"中的书签时自动从服务器删除</p>
            </div>
            <div class="feature-card">
                <h4>📁 自动移动</h4>
                <p>移动书签进出"同步收藏夹"时自动同步</p>
            </div>
            <div class="feature-card">
                <h4>✏️ 自动更新</h4>
                <p>修改"同步收藏夹"中的书签时自动更新服务器</p>
            </div>
        </div>
    </div>

    <div class="test-section info">
        <h2>🧪 测试步骤</h2>
        
        <h3>准备工作</h3>
        <ol class="step-list">
            <li>确保后端服务器运行在 http://localhost:3001</li>
            <li>在扩展中登录你的账号</li>
            <li>重新加载扩展以确保后台脚本正常运行</li>
            <li>打开浏览器开发者工具查看控制台日志</li>
        </ol>

        <h3>测试1：自动上传新书签</h3>
        <ol class="step-list">
            <li>在浏览器中打开任意网页（如 https://www.google.com）</li>
            <li>按 Ctrl+D 收藏书签</li>
            <li>在文件夹选择中，选择或创建"同步收藏夹"文件夹</li>
            <li>点击保存</li>
            <li>观察是否出现"书签已自动同步到服务器"的通知</li>
            <li>检查服务器上是否有对应书签</li>
        </ol>

        <h3>测试2：多级文件夹自动同步</h3>
        <ol class="step-list">
            <li>在"同步收藏夹"下创建子文件夹"工作"</li>
            <li>在"工作"文件夹下再创建"开发工具"文件夹</li>
            <li>收藏书签到"同步收藏夹 > 工作 > 开发工具"</li>
            <li>验证服务器上的书签folder字段是否正确</li>
        </ol>

        <h3>测试3：自动删除同步</h3>
        <ol class="step-list">
            <li>在"同步收藏夹"中删除一个书签</li>
            <li>观察是否出现"书签删除已同步到服务器"的通知</li>
            <li>检查服务器上对应书签是否被删除</li>
        </ol>

        <h3>测试4：移动同步</h3>
        <ol class="step-list">
            <li>将一个普通书签拖拽到"同步收藏夹"中</li>
            <li>观察是否自动上传到服务器</li>
            <li>将"同步收藏夹"中的书签拖拽到其他文件夹</li>
            <li>观察是否自动从服务器删除</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>🔍 调试信息</h2>
        
        <h3>控制台日志</h3>
        <p>在浏览器扩展的后台页面控制台中，你应该能看到以下日志：</p>
        <div class="code-block">
检测到同步收藏夹中的新书签: Google
书签文件夹路径: 同步收藏夹 > 工作 > 开发工具
✅ 书签自动同步成功: Google
        </div>

        <h3>API调用</h3>
        <p>自动同步功能会调用以下后端API：</p>
        <div class="code-block">
POST /bookmarks - 创建新书签
GET /bookmarks/search?url=... - 检查书签是否存在
PUT /bookmarks/:id - 更新书签
DELETE /bookmarks/:id - 删除书签
        </div>

        <h3>事件监听</h3>
        <p>扩展监听以下浏览器书签事件：</p>
        <div class="code-block">
chrome.bookmarks.onCreated - 书签创建
chrome.bookmarks.onRemoved - 书签删除
chrome.bookmarks.onMoved - 书签移动
chrome.bookmarks.onChanged - 书签更新
        </div>
    </div>

    <div class="test-section warning">
        <h2>⚠️ 注意事项</h2>
        <ul>
            <li><strong>登录状态</strong>：必须在扩展中登录才能自动同步</li>
            <li><strong>文件夹限制</strong>：只有"同步收藏夹"及其子文件夹中的书签才会自动同步</li>
            <li><strong>网络连接</strong>：需要能够访问后端服务器</li>
            <li><strong>权限要求</strong>：扩展需要bookmarks权限</li>
            <li><strong>浏览器兼容</strong>：Chrome和Firefox都支持</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>🛠️ 故障排除</h2>
        
        <h3>常见问题</h3>
        <div class="feature-grid">
            <div class="feature-card">
                <h4>❌ 没有自动同步</h4>
                <ul>
                    <li>检查是否已登录扩展</li>
                    <li>确认书签在"同步收藏夹"中</li>
                    <li>重新加载扩展</li>
                    <li>检查后端服务器状态</li>
                </ul>
            </div>
            <div class="feature-card">
                <h4>❌ 同步失败</h4>
                <ul>
                    <li>检查网络连接</li>
                    <li>查看控制台错误信息</li>
                    <li>确认服务器API正常</li>
                    <li>检查token是否过期</li>
                </ul>
            </div>
            <div class="feature-card">
                <h4>❌ 文件夹路径错误</h4>
                <ul>
                    <li>确保"同步收藏夹"文件夹存在</li>
                    <li>检查文件夹层级结构</li>
                    <li>重新创建文件夹</li>
                </ul>
            </div>
            <div class="feature-card">
                <h4>❌ Firefox不工作</h4>
                <ul>
                    <li>使用manifest-firefox.json</li>
                    <li>检查browser-polyfill.js加载</li>
                    <li>确认Firefox版本支持</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="test-section success">
        <h2>🎉 预期结果</h2>
        <ul>
            <li>✅ 收藏到"同步收藏夹"时显示成功通知</li>
            <li>✅ 服务器上出现对应书签</li>
            <li>✅ 文件夹路径正确保存</li>
            <li>✅ 删除、移动、更新操作都能自动同步</li>
            <li>✅ 控制台显示详细的调试信息</li>
            <li>✅ Chrome和Firefox功能一致</li>
        </ul>
    </div>

    <div class="test-section info">
        <h2>🔗 相关文件</h2>
        <ul>
            <li><code>background.js</code> - 后台脚本，包含自动同步逻辑</li>
            <li><code>browser-polyfill.js</code> - 浏览器兼容层</li>
            <li><code>backend/src/routes/bookmarks.js</code> - 后端书签API</li>
            <li><code>manifest.json</code> / <code>manifest-firefox.json</code> - 扩展配置</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>📊 性能监控</h2>
        <p>可以通过以下方式监控自动同步性能：</p>
        <div class="code-block">
// 在控制台中执行
chrome.storage.sync.set({debugMode: true})  // 开启调试模式
chrome.storage.sync.set({debugMode: false}) // 关闭调试模式
        </div>
    </div>
</body>
</html>