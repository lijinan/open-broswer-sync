<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FirefoxåŒæ­¥åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #ff6600;
        }
        .success-section {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        button {
            background: #ff6600;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #e55a00;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }
        .firefox-logo {
            color: #ff6600;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ¦Š FirefoxåŒæ­¥åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="success-section">
        <h2>âœ… è¯­æ³•é”™è¯¯å·²ä¿®å¤</h2>
        <p>Firefoxæ‰©å±•çš„è¯­æ³•é”™è¯¯å·²ç»ä¿®å¤ï¼Œç°åœ¨å¯ä»¥æ­£å¸¸åŠ è½½å’Œè¿è¡Œã€‚</p>
        <p><strong>ä¿®å¤å†…å®¹ï¼š</strong></p>
        <ul>
            <li>ä¿®å¤äº†ç¼ºå¤±çš„æ–¹æ³•å®šä¹‰</li>
            <li>ä¿®å¤äº†å¤šä½™çš„å¤§æ‹¬å·</li>
            <li>å®Œå–„äº†ä¹¦ç­¾åŒæ­¥åŠŸèƒ½</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª æµ‹è¯•åŠŸèƒ½</h2>
        <p>ç°åœ¨å¯ä»¥æµ‹è¯•Firefoxç‰ˆæœ¬çš„å®Œæ•´ä¹¦ç­¾åŒæ­¥åŠŸèƒ½ï¼š</p>
        
        <button onclick="testExtensionStatus()">æ£€æŸ¥æ‰©å±•çŠ¶æ€</button>
        <button onclick="testBookmarkSync()">æµ‹è¯•ä¹¦ç­¾åŒæ­¥</button>
        <button onclick="createFirefoxTestBookmark()">åˆ›å»ºFirefoxæµ‹è¯•ä¹¦ç­¾</button>
        <button onclick="deleteLastBookmark()">åˆ é™¤æœ€åçš„æµ‹è¯•ä¹¦ç­¾</button>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“‹ Firefoxç‰¹æ€§</h2>
        <ul>
            <li><span class="firefox-logo">ğŸ¦Š Firefoxä¸“ç”¨</span> - ä½¿ç”¨browser-polyfill.jså…¼å®¹å±‚</li>
            <li><span class="firefox-logo">ğŸ“¦ Manifest V2</span> - æ”¯æŒbackground scripts</li>
            <li><span class="firefox-logo">ğŸ”„ å®Œæ•´åŒæ­¥</span> - ä¸Chromeç‰ˆæœ¬åŠŸèƒ½ä¸€è‡´</li>
            <li><span class="firefox-logo">ğŸ› ï¸ è°ƒè¯•å‹å¥½</span> - è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>ğŸ“‹ æµ‹è¯•æ—¥å¿—</h2>
        <div id="log" class="log">Firefoxæµ‹è¯•é¡µé¢å·²åŠ è½½...\n</div>
    </div>

    <script>
        let testBookmarks = [];

        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : type === 'success' ? 'âœ…' : 'ğŸ¦Š';
            logElement.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[Firefoxæµ‹è¯•] ${prefix} ${message}`);
        }

        function clearLog() {
            document.getElementById('log').textContent = 'Firefoxæ—¥å¿—å·²æ¸…ç©º...\n';
        }

        async function testExtensionStatus() {
            try {
                log('ğŸ” æ£€æŸ¥Firefoxæ‰©å±•çŠ¶æ€...');
                
                // æ£€æŸ¥browser APIæ˜¯å¦å¯ç”¨
                if (typeof browser !== 'undefined') {
                    log('âœ… browser APIå¯ç”¨ (åŸç”ŸFirefox API)');
                } else if (typeof chrome !== 'undefined') {
                    log('âœ… chrome APIå¯ç”¨ (é€šè¿‡polyfill)');
                } else {
                    log('âŒ æ‰©å±•APIä¸å¯ç”¨', 'error');
                    return;
                }

                // æ£€æŸ¥æ‰©å±•è®¾ç½®
                const settings = await new Promise((resolve) => {
                    if (typeof browser !== 'undefined') {
                        browser.storage.sync.get().then(resolve);
                    } else {
                        chrome.storage.sync.get(resolve);
                    }
                });

                log(`ç™»å½•çŠ¶æ€: ${settings.token ? 'å·²ç™»å½•' : 'æœªç™»å½•'}`);
                log(`æœåŠ¡å™¨åœ°å€: ${settings.serverUrl || 'æœªé…ç½®'}`);
                log(`è°ƒè¯•æ¨¡å¼: ${settings.debugMode ? 'å·²å¼€å¯' : 'æœªå¼€å¯'}`);

                if (settings.token) {
                    log('Firefoxæ‰©å±•çŠ¶æ€æ­£å¸¸', 'success');
                } else {
                    log('è¯·å…ˆç™»å½•Firefoxæ‰©å±•', 'warning');
                }

            } catch (error) {
                log(`æ£€æŸ¥æ‰©å±•çŠ¶æ€å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testBookmarkSync() {
            try {
                log('ğŸ”„ æµ‹è¯•Firefoxä¹¦ç­¾åŒæ­¥åŠŸèƒ½...');
                
                // å‘é€æµ‹è¯•æ¶ˆæ¯ç»™åå°è„šæœ¬
                const api = typeof browser !== 'undefined' ? browser : chrome;
                
                const response = await api.runtime.sendMessage({
                    type: 'TEST_NOTIFICATION',
                    message: 'FirefoxåŒæ­¥æµ‹è¯• - ' + new Date().toLocaleTimeString()
                });

                if (response && response.success) {
                    log('âœ… Firefoxåå°è„šæœ¬é€šä¿¡æ­£å¸¸', 'success');
                } else {
                    log('âš ï¸ åå°è„šæœ¬å“åº”å¼‚å¸¸', 'warning');
                }

            } catch (error) {
                log(`æµ‹è¯•åŒæ­¥åŠŸèƒ½å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function createFirefoxTestBookmark() {
            try {
                log('ğŸ“š åœ¨Firefoxä¸­åˆ›å»ºæµ‹è¯•ä¹¦ç­¾...');
                
                const api = typeof browser !== 'undefined' ? browser : chrome;
                
                // æŸ¥æ‰¾åŒæ­¥æ”¶è—å¤¹
                const syncFolders = await api.bookmarks.search({ title: 'åŒæ­¥æ”¶è—å¤¹' });
                
                if (syncFolders.length === 0) {
                    log('âŒ æœªæ‰¾åˆ°"åŒæ­¥æ”¶è—å¤¹"ï¼Œè¯·å…ˆåˆ›å»º', 'error');
                    return;
                }
                
                const syncFolder = syncFolders[0];
                log(`ğŸ“ ä½¿ç”¨åŒæ­¥æ”¶è—å¤¹: ${syncFolder.id}`);
                
                // åˆ›å»ºFirefoxæµ‹è¯•ä¹¦ç­¾
                const testBookmark = await api.bookmarks.create({
                    title: `Firefoxæµ‹è¯•ä¹¦ç­¾ - ${Date.now()}`,
                    url: `https://firefox-test.example.com/${Date.now()}`,
                    parentId: syncFolder.id
                });
                
                testBookmarks.push(testBookmark);
                log(`âœ… Firefoxæµ‹è¯•ä¹¦ç­¾å·²åˆ›å»º: ${testBookmark.title}`, 'success');
                log(`ğŸ“ ä¹¦ç­¾ID: ${testBookmark.id}`);
                log('â³ ç­‰å¾…è‡ªåŠ¨åŒæ­¥åˆ°æœåŠ¡å™¨...');
                
            } catch (error) {
                log(`åˆ›å»ºFirefoxæµ‹è¯•ä¹¦ç­¾å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function deleteLastBookmark() {
            try {
                if (testBookmarks.length === 0) {
                    log('âš ï¸ æ²¡æœ‰å¯åˆ é™¤çš„æµ‹è¯•ä¹¦ç­¾', 'warning');
                    return;
                }

                const bookmarkToDelete = testBookmarks.pop();
                log(`ğŸ—‘ï¸ åˆ é™¤Firefoxæµ‹è¯•ä¹¦ç­¾: ${bookmarkToDelete.title}`);
                
                const api = typeof browser !== 'undefined' ? browser : chrome;
                await api.bookmarks.remove(bookmarkToDelete.id);
                
                log(`âœ… Firefoxæµ‹è¯•ä¹¦ç­¾å·²åˆ é™¤: ${bookmarkToDelete.title}`, 'success');
                log('â³ ç­‰å¾…åˆ é™¤åŒæ­¥åˆ°æœåŠ¡å™¨...');
                
            } catch (error) {
                log(`åˆ é™¤Firefoxæµ‹è¯•ä¹¦ç­¾å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        log('ğŸ¦Š FirefoxåŒæ­¥åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½');
        log('ğŸ’¡ æµ‹è¯•æ­¥éª¤:');
        log('   1. æ£€æŸ¥æ‰©å±•çŠ¶æ€');
        log('   2. æµ‹è¯•ä¹¦ç­¾åŒæ­¥');
        log('   3. åˆ›å»ºå’Œåˆ é™¤æµ‹è¯•ä¹¦ç­¾');
        log('   4. è§‚å¯Ÿæ§åˆ¶å°çš„åŒæ­¥æ—¥å¿—');
        
        // è‡ªåŠ¨æ£€æŸ¥æ‰©å±•çŠ¶æ€
        setTimeout(() => {
            testExtensionStatus();
        }, 1000);
    </script>
</body>
</html>